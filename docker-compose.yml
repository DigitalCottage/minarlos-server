version: '3.8'

services:
  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    restart: unless-stopped
    environment:
      WEBSOCKET_ENABLED: 'true'  # Required for live sync
    volumes:
      - vaultwarden/data:/data
    expose:
      - 80  # Only exposed to reverse proxy
    networks:
      - nginx_network

  nginx:
    image: jc21/nginx-proxy-manager:latest
    container_name: nginx_proxy_manager
    restart: unless-stopped
    ports:
      - "80:80"     # HTTP
      - "443:443"   # HTTPS
      - "81:81"     # Admin panel
    volumes:
      - nginx/data:/data
      - nginx/letsencrypt:/etc/letsencrypt
    networks:
      - nginx_network

volumes:
  vaultwarden_data:
  nginx_data:
  nginx_letsencrypt:

networks:
  nginx_network:
    driver: bridge
